# Docker Compose for local development
# This sets up Qdrant for the memory system

version: '3.8'

services:
  # Vector database for Mem0
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334

  # PostgreSQL for metadata (optional)
  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: threads_agent
      POSTGRES_PASSWORD: dev_password
      POSTGRES_DB: threads_agent
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # The agent itself (for local testing)
  agent:
    build: .
    depends_on:
      - qdrant
      - postgres
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - THREADS_APP_ID=${THREADS_APP_ID}
      - THREADS_APP_SECRET=${THREADS_APP_SECRET}
      - THREADS_ACCESS_TOKEN=${THREADS_ACCESS_TOKEN}
      - THREADS_USER_ID=${THREADS_USER_ID}
      - QDRANT_URL=http://qdrant:6333
      - DATABASE_URL=postgresql://threads_agent:dev_password@postgres:5432/threads_agent
      - LOG_LEVEL=DEBUG
    volumes:
      - ./personas:/app/personas:ro

volumes:
  qdrant_data:
  postgres_data:
